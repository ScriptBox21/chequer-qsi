![Logo](https://github.com/chequer-io/qsi/blob/master/Resources/logo-256.png?raw=true)

The QSI is the pure C# Query Structure Interface.

### Languages

|Language|Parser|Repos|
|--|--|--|
|MySql|Antlr4|[grammars-v4](https://github.com/antlr/grammars-v4)|
|PostgreSql10|PostgreSQL server source code|[libpg_query](https://github.com/lfittl/libpg_query), [ChakraCore](https://github.com/microsoft/ChakraCore)|
|JSql|JavaCC|[JSqlParser](https://github.com/JSQLParser/JSqlParser), [IKVM](https://github.com/ikvm-revived/ikvm)|
|Oracle|Qsi.JSql||
|SqlServer|Microsoft.SqlServer.TransactSql.ScriptDom|[MSDN](https://docs.microsoft.com/en-us/dotnet/api/microsoft.sqlserver.transactsql.scriptdom?view=sql-dacfx-150), [NuGet](https://www.nuget.org/packages/Microsoft.SqlServer.TransactSql.ScriptDom)|


### Common Structure Compiler
It compiles the result structure and relation 

based on semantic tree generated by parser's  for each language.

## Specification

### Status

|Features                           |MySql   |PostgreSql|JSql    |Oracle  |
|-----------------------------------|:------:|:--------:|:------:|:------:|
|No table                           |&#x2714;|&#x2714;  |&#x2714;|&#x274C;|
|Table access                       |&#x2714;|&#x2714;  |&#x2714;|&#x2714;|
|Derived table                      |&#x2714;|&#x2714;  |&#x2714;|&#x2714;|
|Derived table (Non-Alias)          |&#x274C;|&#x274C;  |&#x2714;|&#x2714;|
|Inline derived table               |&#x274C;|&#x2714;  |&#x2714;|&#x2714;|
|Table function                     |&#x26A0;|&#x26A0;  |&#x26A0;|&#x26A0;|
|Common table expression            |&#x2714;|&#x2714;  |&#x2714;|&#x2714;|
|Common table expression (Aliases)  |&#x2714;|&#x2714;  |&#x2714;|&#x2714;|
|Common table expression (Recursive)|&#x2714;|&#x2714;  |&#x2714;|&#x2714;|
|Join tables                        |&#x2714;|&#x2714;  |&#x2714;|&#x2714;|
|Join tables (Pivot columns)        |&#x2714;|&#x2714;  |&#x2714;|&#x2714;|
|Union many tables                  |&#x2714;|&#x2714;  |&#x2714;|&#x2714;|
|Table pivot                        |&#x26A0;|&#x26A0;  |&#x26A0;|&#x26A0;|
|Table unpivot                      |&#x26A0;|&#x26A0;  |&#x26A0;|&#x26A0;|
|Trace view definition              |&#x2714;|&#x2714;  |&#x2714;|&#x2714;|

### Table Features

<table>

<tr>
<th>Done?</th>
<th>Feature</th>
<th colspan="2">Example</th>
</tr>

<!-- No table -->
<tr>
<td align="center">&#9745;</td>
<td>No table</td>
<td>

```sql
-- table : id, name
SELECT 1 AS a, '2' AS b
```
</td>
<td>

|Column|References            |
|:----:|----------------------|
|`a`   |1 <em>(literal)</em>  |
|`b`   |'2' <em>(literal)</em>|
</td>
</tr>

<!-- Table access -->
<tr>
<td align="center">&#9745;</td>
<td>Table access</td>
<td>

```sql
-- table : id, name
SELECT * FROM table
```
</td>
<td>

|Column|References  |
|:----:|------------|
|`id`  |table.`id`  |
|`name`|table.`name`|
</td>
</tr>

<!-- Derived table -->
<tr>
<td align="center">&#9745;</td>
<td>Derived table</td>
<td>

```sql
-- table : id, name
SELECT * FROM (SELECT * FROM table) AS alias
```
</td>
<td>

|Column|References  |
|:----:|------------|
|`id`  |alias.`id`  |
|      |table.`id`  |
|`name`|alias.`name`|
|      |table.`name`|
</td>
</tr>

<!-- Inline derived table -->
<tr>
<td align="center">&#9745;</td>
<td>Inline derived table</td>
<td>

```sql
SELECT * FROM
    (VALUES (1, 2)) AS inline_table(a, b)
```
</td>
<td>

|Column|References          |
|:----:|--------------------|
|`a`   |inline_table.`a`    |
|      |1 <em>(literal)</em>|
|`b`   |inline_table.`b`    |
|      |2 <em>(literal)</em>|
</td>
</tr>

<!-- Table function -->
<tr>
<td align="center">&#9744;</td>
<td>Table function</td>
<td>

```sql
-- TODO
```
</td>
<td>

<!--
|Column|References|
|:-:|-|
|||
-->
</td>
</tr>

<!-- Common table expression -->
<tr>
<td align="center">&#9745;</td>
<td>Common table expression</td>
<td>

```sql
WITH cte AS (SELECT 1 AS n)
..
```
</td>
<td>

|Column|References          |
|:----:|--------------------|
|`n`   |1 <em>(literal)</em>|
</td>
</tr>

<!-- Common table expression (Aliases) -->
<tr>
<td align="center">&#9745;</td>
<td>Common table expression (Aliases)</td>
<td>

```sql
WITH cte (n) AS (SELECT 1)
..
```
</td>
<td>

|Column |References          |
|:-----:|--------------------|
|`n`    |1 <em>(literal)</em>|
</td>
</tr>

<!-- Common table expression (Recursive) -->
<tr>
<td align="center">&#9745;</td>
<td>Common table expression (Recursive)</td>
<td>

```sql
WITH RECURSIVE cte AS (
    SELECT 1 AS n
    UNION ALL
    SELECT n + 1 FROM cte WHERE n < 10
)
..
```
</td>
<td>

|Column|References                  |
|:----:|----------------------------|
|`n`   |1 <em>(literal)</em>        |
|      |cte.`n` <em>(recursive)</em>|
</td>
</tr>

<!-- Join tables -->
<tr>
<td align="center">&#9745;</td>
<td>Join tables</td>
<td>

```sql
-- left_table : name, uid
-- right_table : age, uid
SELECT * FROM
    left_table JOIN right_table ON ..
    ..
```
</td>
<td>

|Column|References|
|:-:|-|
|`name`|left_table.`name`|
|`uid` |left_table.`uid` |
|`age` |right_table.`age`|
|`uid` |right_table.`uid`|
</td>
</tr>

<!-- Join tables (Pivot columns) -->
<tr>
<td align="center">&#9745;</td>
<td>Join tables (Pivot columns)</td>
<td>

```sql
-- left_table : name, uid
-- right_table : age, uid
SELECT * FROM
    left_table JOIN right_table USING (uid)
    ..
```
</td>
<td>

|Column|References       |
|:----:|-----------------|
|`uid` |left_table.`uid` |
|      |right_table.`uid`|
|`name`|left_table.`name`|
|`age` |right_table.`age`|
</td>
</tr>

<!-- Union many tables -->
<tr>
<td align="center">&#9745;</td>
<td>Union many tables</td>
<td>

```sql
SELECT column1 FROM first_table
UNION ALL
SELECT column2 FROM second_table
```
</td>
<td>

|Column   |References            |
|:-------:|----------------------|
|`column1`|first_table.`column1` |
|         |second_table.`column2`|
</td>
</tr>

<!-- Table pivot -->
<tr>
<td align="center">&#9744;</td>
<td>Table pivot</td>
<td>

```sql
-- TODO
```
</td>
<td>

<!--
|Column|References|
|:-:|-|
|||
-->
</td>
</tr>

<!-- Table unpivot -->
<tr>
<td align="center">&#9744;</td>
<td>Table unpivot</td>
<td>

```sql
-- TODO
```
</td>
<td>

<!--
|Column|References|
|:-:|-|
|||
-->
</td>
</tr>

<!-- Trace view definition -->
<tr>
<td align="center">&#9745;</td>
<td>Trace view definition</td>
<td>

```sql
-- table_view : a, b
-- table : id, name
SELECT * FROM table_view
```
</td>
<td>

|Column|References    |
|:----:|--------------|
|`a`   |table_view.`a`|
|      |table.`id`    |
|`b`   |table_view.`b`|
|      |table.`name`  |
</td>
</tr>

</table>

## Development

#### Requirements

- PowerShell
- .NET Core 3.1
- Java >= 1.8

### Command

#### Setup

```ps1
PS> cd ./qsi
PS> ./Setup.ps1
```

#### Publish

```ps1
PS> cd ./qsi
PS> ./Publish.ps1 <VERSION> [-Mode <PUBLISH_MODE>]
```

- `<VERSION>`

  Specifies the package version.
  
  Version must be greater than the latest version tag on git.

- `-Mode <PUBLISH_MODE>`

  Specifies the publish mode.
  
  |PUBLISH_MODE|Action|
  |--|--|
  |Publish(Default)|Publish packages to NuGet, GitHub repositories|
  |Local|Publish packages to local repository|
  |Archive|Build packages to `./qsi/Publish`|
  
  

### Debugger

It supports abstract syntax trees and semantic trees, and a debugger that can debug compilation results.

|OS|Support|
|--|--|
|Windows|O|
|OSX|O|
|Linux|X|

![Preview](https://github.com/chequer-io/qsi/blob/master/Qsi.Debugger/Screenshot.png?raw=true)

### Run
```sh
$ cd qsi/Qsi.Debugger
$ dotnet run
```
